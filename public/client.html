<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Braids by Zonke - Client Dashboard</title>
    
    <!-- SweetAlert2 for better alerts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#fef6ee',
                100: '#fdebd7',
                200: '#f9d4af',
                300: '#f4b57d',
                400: '#ee904b',
                500: '#ea7c2a',
                600: '#db641f',
                700: '#b64d1c',
                800: '#913f1d',
                900: '#75361b',
              },
              secondary: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                500: '#0ea5e9',
                600: '#0284c7',
              }
            }
          }
        }
      }
    </script>
    <script
      src="https://kit.fontawesome.com/a2d9d6a62b.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>

    <style>
      :root {
        --primary: #ea7c2a;
        --primary-light: #fef6ee;
        --primary-dark: #b64d1c;
        --secondary: #0ea5e9;
        --accent: #8b5cf6;
        --dark: #1f2937;
        --light: #f9fafb;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #fef6ee 0%, #f0f9ff 100%);
        min-height: 100vh;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        border-radius: 10px;
      }

      /* Modern glass effect */
      .glass {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(234, 124, 42, 0.1);
      }

      /* Gradient text */
      .gradient-text {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Card hover effects */
      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(234, 124, 42, 0.15);
      }

      /* Gradient buttons */
      .btn-gradient-primary {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .btn-gradient-primary:hover {
        background: linear-gradient(135deg, var(--primary-dark), #913f1d);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(234, 124, 42, 0.3);
      }

      /* Sidebar active item */
      .sidebar-item.active {
        background: linear-gradient(90deg, rgba(234, 124, 42, 0.1), transparent);
        border-left: 4px solid var(--primary);
        color: var(--primary);
      }

      /* Section headers */
      .section-header {
        background: linear-gradient(90deg, rgba(234, 124, 42, 0.1) 0%, rgba(234, 124, 42, 0.05) 100%);
        border-left: 4px solid var(--primary);
      }

      /* Card backgrounds with subtle patterns */
      .card-pattern {
        background-image: 
          radial-gradient(circle at 10% 20%, rgba(234, 124, 42, 0.05) 0%, transparent 20%),
          radial-gradient(circle at 90% 80%, rgba(14, 165, 233, 0.05) 0%, transparent 20%);
      }

      /* Fade animations */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .fade-in { animation: fadeIn 0.5s ease; }
      .slide-up { animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

      /* Loading spinner */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(234, 124, 42, 0.3);
        border-radius: 50%;
        border-top-color: var(--primary);
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin { to { transform: rotate(360deg); } }

      /* Mobile sidebar */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          position: fixed;
          z-index: 50;
          height: 100vh;
          overflow-y: auto;
          width: 280px;
          background: linear-gradient(180deg, #ffffff 0%, #fef9f3 100%);
          box-shadow: 4px 0 15px rgba(234, 124, 42, 0.1);
        }

        .sidebar.open { transform: translateX(0); }

        .overlay {
          display: none;
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(4px);
          z-index: 40;
        }

        .overlay.open { 
          display: block;
          animation: fadeIn 0.3s ease-in-out;
        }
      }

      /* Badge styles */
      .badge {
        @apply px-2 py-1 text-xs font-medium rounded-full;
      }

      .badge-upcoming { 
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        color: #92400e;
      }
      .badge-completed { 
        background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        color: #065f46;
      }
      .badge-cancelled { 
        background: linear-gradient(135deg, #fee2e2, #fca5a5);
        color: #991b1b;
      }

      /* Input modern */
      .input-modern {
        @apply border border-gray-300 rounded-xl px-4 py-3 focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none transition-all bg-white;
      }

      /* Stats Card */
      .stats-card {
        background: linear-gradient(135deg, #ffffff 0%, #fef9f3 100%);
        border: 1px solid rgba(234, 124, 42, 0.1);
        transition: all 0.3s ease;
      }

      .stats-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(234, 124, 42, 0.15);
        border-color: rgba(234, 124, 42, 0.3);
      }
    </style>
  </head>
  <body class="flex font-sans min-h-screen">
    <!-- Overlay for mobile -->
    <div id="overlay" class="overlay" onclick="closeMobileSidebar()"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar w-64 shadow-2xl border-r border-primary-200">
      <div class="p-6 border-b border-primary-200 relative" style="background: linear-gradient(90deg, rgba(234, 124, 42, 0.1) 0%, rgba(234, 124, 42, 0.05) 100%);">
        <div class="flex items-center space-x-3 mb-6">
          <div class="relative">
            <div class="w-12 h-12 bg-gradient-to-br from-primary-500 to-primary-600 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fas fa-crown text-white text-xl"></i>
            </div>
            <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-400 rounded-full border-2 border-white"></div>
          </div>
          <div>
            <h1 class="text-xl font-bold gradient-text">Braids by Zonke</h1>
            <p class="text-primary-600 text-xs font-medium">Premium Braiding Studio</p>
          </div>
        </div>
        <button id="close-sidebar" class="md:hidden absolute top-6 right-6 text-primary-600 hover:text-primary-800 transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <nav class="p-4 space-y-1">
        <a href="#dashboard" class="sidebar-item flex items-center p-3 rounded-xl hover:bg-gradient-to-r hover:from-primary-50 hover:to-transparent text-primary-700 font-medium transition-all duration-300 active group">
          <div class="w-8 h-8 bg-gradient-to-br from-primary-500 to-primary-600 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-home text-white text-sm"></i>
          </div>
          <span class="flex-1">Dashboard</span>
        </a>
        
        <a href="#bookings" class="sidebar-item flex items-center p-3 rounded-xl hover:bg-gradient-to-r hover:from-blue-50 hover:to-transparent text-primary-700 font-medium transition-all duration-300 group">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-calendar-check text-white text-sm"></i>
          </div>
          <span class="flex-1">My Bookings</span>
          <span id="booking-count" class="px-2 py-1 text-xs bg-primary-100 text-primary-700 rounded-full font-bold">0</span>
        </a>
        
        <a href="#new-booking" class="sidebar-item flex items-center p-3 rounded-xl hover:bg-gradient-to-r hover:from-purple-50 hover:to-transparent text-primary-700 font-medium transition-all duration-300 group">
          <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-plus-circle text-white text-sm"></i>
          </div>
          <span class="flex-1">New Booking</span>
        </a>

        <a href="#style-gallery" class="sidebar-item flex items-center p-3 rounded-xl hover:bg-gradient-to-r hover:from-green-50 hover:to-transparent text-primary-700 font-medium transition-all duration-300 group">
          <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-emerald-500 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-images text-white text-sm"></i>
          </div>
          <span class="flex-1">Style Gallery</span>
        </a>

        <a href="#my-profile" class="sidebar-item flex items-center p-3 rounded-xl hover:bg-gradient-to-r hover:from-yellow-50 hover:to-transparent text-primary-700 font-medium transition-all duration-300 group">
          <div class="w-8 h-8 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-user text-white text-sm"></i>
          </div>
          <span class="flex-1">My Profile</span>
        </a>

        <a href="#messages" class="sidebar-item flex items-center p-3 rounded-xl hover:bg-gradient-to-r hover:from-indigo-50 hover:to-transparent text-primary-700 font-medium transition-all duration-300 group">
          <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-500 rounded-lg flex items-center justify-center mr-3">
            <i class="fas fa-comments text-white text-sm"></i>
          </div>
          <span class="flex-1">Messages</span>
          <span id="message-count" class="px-2 py-1 text-xs bg-indigo-100 text-indigo-700 rounded-full font-bold hidden">0</span>
        </a>
      </nav>
      
      <div class="p-4 mt-auto" style="background: linear-gradient(90deg, rgba(234, 124, 42, 0.05) 0%, rgba(234, 124, 42, 0.02) 100%);">
        <div class="glass p-4 rounded-xl mb-4 border border-primary-200">
          <div class="flex items-center">
            <div class="relative">
              <div id="user-avatar" class="w-12 h-12 bg-gradient-to-br from-primary-400 to-primary-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-user text-white"></i>
              </div>
              <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center border-2 border-white">
                <i class="fas fa-check text-white text-xs"></i>
              </div>
            </div>
            <div class="ml-3 flex-1">
              <p id="user-name" class="font-semibold text-primary-800 truncate">Loading...</p>
              <p class="text-primary-600 text-xs">Valued Client</p>
            </div>
          </div>
        </div>
        
        <button id="logout-btn" class="w-full btn-gradient-primary px-4 py-2.5 rounded-lg font-semibold shadow-lg transition-all duration-200 flex items-center justify-center">
          <i class="fas fa-sign-out-alt mr-2"></i> Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content flex-1 flex flex-col overflow-hidden">
      <!-- Top Navbar -->
      <header class="flex items-center justify-between bg-white shadow-sm px-4 md:px-6 py-4 sticky top-0 z-30 border-b border-primary-200" style="background: linear-gradient(90deg, #ffffff 0%, #fef9f3 100%);">
        <div class="flex items-center">
          <button id="menuBtn" class="md:hidden text-primary-600 text-xl mr-4 hover:text-primary-800 transition-colors">
            <i class="fas fa-bars"></i>
          </button>
          <div>
            <h2 class="text-xl font-bold text-primary-800" id="page-title">Dashboard</h2>
            <p class="text-sm text-primary-500" id="page-subtitle">Welcome to your client portal</p>
          </div>
        </div>
        
        <div class="flex items-center space-x-4">
          <div class="hidden md:flex items-center space-x-3">
            <div class="text-right">
              <p id="userEmail" class="text-sm font-medium text-primary-700"></p>
              <p class="text-xs text-primary-500">Premium Member</p>
            </div>
            <div class="relative">
              <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl flex items-center justify-center shadow">
                <span class="text-white font-bold" id="user-initial">U</span>
              </div>
              <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <main class="flex-1 p-4 md:p-6 overflow-y-auto">
        <!-- Dashboard Section -->
        <section id="dashboard" class="fade-in">
          <!-- Welcome Header -->
          <div class="rounded-2xl p-6 mb-8 bg-gradient-to-r from-primary-500/5 to-secondary-500/5 border border-primary-200 card-pattern">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
              <div>
                <h1 class="text-2xl md:text-3xl font-bold text-primary-800 mb-2" id="welcome-message">Welcome back!</h1>
                <p class="text-primary-600">Ready for your next beautiful transformation?</p>
              </div>
              <div class="mt-4 md:mt-0">
                <button id="new-appointment-btn" class="btn-gradient-primary text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300">
                  <i class="fas fa-plus-circle mr-2"></i>Book New Appointment
                </button>
              </div>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="stats-card rounded-2xl p-6 border-t-4 border-secondary-500 card-pattern">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <p class="text-primary-600 font-medium">Next Appointment</p>
                  <p class="text-xl font-bold text-primary-800 mt-2" id="next-appointment">No upcoming</p>
                </div>
                <div class="w-14 h-14 bg-gradient-to-br from-secondary-100 to-secondary-200 rounded-xl flex items-center justify-center">
                  <i class="fas fa-calendar-day text-secondary-600 text-xl"></i>
                </div>
              </div>
            </div>

            <div class="stats-card rounded-2xl p-6 border-t-4 border-green-500 card-pattern">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <p class="text-primary-600 font-medium">Total Styles</p>
                  <p class="text-3xl font-bold text-primary-800 mt-2" id="total-styles">0</p>
                </div>
                <div class="w-14 h-14 bg-gradient-to-br from-green-100 to-green-200 rounded-xl flex items-center justify-center">
                  <i class="fas fa-crown text-green-600 text-xl"></i>
                </div>
              </div>
            </div>

            <div class="stats-card rounded-2xl p-6 border-t-4 border-purple-500 card-pattern">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <p class="text-primary-600 font-medium">Loyalty Points</p>
                  <p class="text-3xl font-bold text-primary-800 mt-2" id="loyalty-points">0</p>
                </div>
                <div class="w-14 h-14 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl flex items-center justify-center">
                  <i class="fas fa-gem text-purple-600 text-xl"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Links -->
          <div class="mb-8">
            <h3 class="text-lg font-bold text-primary-800 mb-4 flex items-center">
              <i class="fas fa-bolt text-primary-500 mr-2"></i>Quick Links
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <a href="#style-gallery" class="stats-card p-5 rounded-xl flex items-center group quick-link border border-primary-200 hover:border-primary-300 transition">
                <div class="w-12 h-12 bg-gradient-to-br from-green-400 to-emerald-500 rounded-xl flex items-center justify-center mr-4 shadow-md">
                  <i class="fas fa-images text-white"></i>
                </div>
                <div class="flex-1">
                  <h4 class="font-bold text-primary-800">Style Gallery</h4>
                  <p class="text-sm text-primary-600">Browse beautiful braiding styles</p>
                </div>
                <i class="fas fa-chevron-right text-primary-400 group-hover:text-green-500 transition"></i>
              </a>

              <a href="#my-profile" class="stats-card p-5 rounded-xl flex items-center group quick-link border border-primary-200 hover:border-primary-300 transition">
                <div class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl flex items-center justify-center mr-4 shadow-md">
                  <i class="fas fa-user text-white"></i>
                </div>
                <div class="flex-1">
                  <h4 class="font-bold text-primary-800">My Hair Profile</h4>
                  <p class="text-sm text-primary-600">Update your hair details & preferences</p>
                </div>
                <i class="fas fa-chevron-right text-primary-400 group-hover:text-yellow-500 transition"></i>
              </a>
            </div>
          </div>

          <!-- Recent Activity -->
          <div>
            <h3 class="text-lg font-bold text-primary-800 mb-4 flex items-center">
              <i class="fas fa-history text-primary-500 mr-2"></i>Recent Activity
            </h3>
            <div class="stats-card rounded-xl border border-primary-200">
              <div id="recent-activity" class="divide-y divide-primary-100">
                <div class="p-8 text-center">
                  <div class="inline-block p-4 rounded-full bg-primary-100 mb-4">
                    <div class="loading"></div>
                  </div>
                  <p class="text-primary-500">Loading your activity...</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Bookings Section -->
        <section id="bookings" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-2xl font-bold text-primary-800 mb-2">My Bookings</h2>
            <p class="text-primary-600">Manage your appointments with Zonke</p>
          </div>

          <div class="stats-card rounded-2xl overflow-hidden border border-primary-200">
            <div class="border-b border-primary-200">
              <div class="flex overflow-x-auto">
                <button class="tab-button px-6 py-4 font-semibold border-b-2 border-primary-500 text-primary-600 flex items-center" data-tab="upcoming">
                  <i class="fas fa-clock mr-2"></i>Upcoming
                  <span id="upcoming-tab-count" class="ml-2 px-2 py-1 text-xs bg-primary-100 text-primary-700 rounded-full">0</span>
                </button>
                <button class="tab-button px-6 py-4 font-semibold text-primary-500 hover:text-primary-700 transition flex items-center" data-tab="past">
                  <i class="fas fa-history mr-2"></i>Past Appointments
                  <span id="past-tab-count" class="ml-2 px-2 py-1 text-xs bg-primary-100 text-primary-700 rounded-full">0</span>
                </button>
              </div>
            </div>

            <div id="upcoming-bookings" class="divide-y divide-primary-100">
              <!-- Dynamic content -->
            </div>

            <div id="past-bookings" class="divide-y divide-primary-100 hidden">
              <!-- Dynamic content -->
            </div>
          </div>
        </section>

        <!-- New Booking Section -->
        <section id="new-booking" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-2xl font-bold text-primary-800 mb-2">New Booking</h2>
            <p class="text-primary-600">Schedule your appointment with Zonke</p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
              <form id="bookingForm" class="stats-card rounded-2xl p-6 md:p-8 space-y-6 border border-primary-200">
                <div>
                  <label class="block text-sm font-semibold text-primary-600 mb-3 flex items-center">
                    <i class="fas fa-palette text-primary-500 mr-2"></i>
                    Select Style
                  </label>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="style-option relative">
                      <input type="radio" name="style" id="box-braids" value="Box Braids" data-price="500" class="hidden peer" checked>
                      <label for="box-braids" class="block p-4 border-2 border-primary-200 rounded-xl cursor-pointer peer-checked:border-primary-500 peer-checked:bg-gradient-to-r peer-checked:from-primary-50 peer-checked:to-transparent transition-all duration-300 hover:border-primary-300 card-hover">
                        <div class="flex items-center justify-between mb-2">
                          <span class="font-semibold text-primary-800">Box Braids</span>
                          <span class="font-bold text-primary-600">R500</span>
                        </div>
                        <p class="text-sm text-primary-600">Classic protective style</p>
                        <div class="mt-3 flex items-center text-sm text-primary-500">
                          <i class="fas fa-clock mr-1"></i>
                          <span>3-4 hours</span>
                        </div>
                      </label>
                    </div>

                    <div class="style-option relative">
                      <input type="radio" name="style" id="knotless-braids" value="Knotless Braids" data-price="600" class="hidden peer">
                      <label for="knotless-braids" class="block p-4 border-2 border-primary-200 rounded-xl cursor-pointer peer-checked:border-primary-500 peer-checked:bg-gradient-to-r peer-checked:from-primary-50 peer-checked:to-transparent transition-all duration-300 hover:border-primary-300 card-hover">
                        <div class="flex items-center justify-between mb-2">
                          <span class="font-semibold text-primary-800">Knotless Braids</span>
                          <span class="font-bold text-primary-600">R600</span>
                        </div>
                        <p class="text-sm text-primary-600">Seamless, natural look</p>
                        <div class="mt-3 flex items-center text-sm text-primary-500">
                          <i class="fas fa-clock mr-1"></i>
                          <span>4-5 hours</span>
                        </div>
                      </label>
                    </div>

                    <div class="style-option relative">
                      <input type="radio" name="style" id="cornrows" value="Cornrows" data-price="350" class="hidden peer">
                      <label for="cornrows" class="block p-4 border-2 border-primary-200 rounded-xl cursor-pointer peer-checked:border-primary-500 peer-checked:bg-gradient-to-r peer-checked:from-primary-50 peer-checked:to-transparent transition-all duration-300 hover:border-primary-300 card-hover">
                        <div class="flex items-center justify-between mb-2">
                          <span class="font-semibold text-primary-800">Cornrows</span>
                          <span class="font-bold text-primary-600">R350</span>
                        </div>
                        <p class="text-sm text-primary-600">Traditional braiding style</p>
                        <div class="mt-3 flex items-center text-sm text-primary-500">
                          <i class="fas fa-clock mr-1"></i>
                          <span>2-3 hours</span>
                        </div>
                      </label>
                    </div>

                    <div class="style-option relative">
                      <input type="radio" name="style" id="goddess-braids" value="Goddess Braids" data-price="550" class="hidden peer">
                      <label for="goddess-braids" class="block p-4 border-2 border-primary-200 rounded-xl cursor-pointer peer-checked:border-primary-500 peer-checked:bg-gradient-to-r peer-checked:from-primary-50 peer-checked:to-transparent transition-all duration-300 hover:border-primary-300 card-hover">
                        <div class="flex items-center justify-between mb-2">
                          <span class="font-semibold text-primary-800">Goddess Braids</span>
                          <span class="font-bold text-primary-600">R550</span>
                        </div>
                        <p class="text-sm text-primary-600">Boho-chic look</p>
                        <div class="mt-3 flex items-center text-sm text-primary-500">
                          <i class="fas fa-clock mr-1"></i>
                          <span>3-4 hours</span>
                        </div>
                      </label>
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label class="block text-sm font-semibold text-primary-600 mb-3 flex items-center">
                      <i class="fas fa-calendar text-primary-500 mr-2"></i>
                      Date
                    </label>
                    <div class="relative">
                      <input type="date" id="date" class="input-modern w-full rounded-xl p-4 pr-12" required>
                      <i class="fas fa-calendar-alt absolute right-4 top-1/2 transform -translate-y-1/2 text-primary-400"></i>
                    </div>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-primary-600 mb-3 flex items-center">
                      <i class="fas fa-clock text-primary-500 mr-2"></i>
                      Time
                    </label>
                    <div class="relative">
                      <input type="time" id="time" class="input-modern w-full rounded-xl p-4 pr-12" required>
                      <i class="fas fa-clock absolute right-4 top-1/2 transform -translate-y-1/2 text-primary-400"></i>
                    </div>
                  </div>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-primary-600 mb-3 flex items-center">
                    <i class="fas fa-sticky-note text-primary-500 mr-2"></i>
                    Special Requests
                  </label>
                  <textarea id="specialRequests" class="input-modern w-full rounded-xl p-4" rows="4" placeholder="Any special instructions, hair type details, or requests..."></textarea>
                </div>

                <div class="flex items-center justify-between pt-4 border-t border-primary-100">
                  <div>
                    <p class="text-sm text-primary-500">Total Amount</p>
                    <p class="text-2xl font-bold text-primary-800" id="total-amount">R500</p>
                  </div>
                  <button type="submit" id="submit-booking" class="btn-gradient-primary text-white px-8 py-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300 flex items-center">
                    <i class="fas fa-calendar-check mr-3"></i>
                    <span id="submit-text">Book Appointment</span>
                    <div id="submit-loading" class="hidden ml-3">
                      <div class="loading"></div>
                    </div>
                  </button>
                </div>
              </form>
            </div>

            <!-- Booking Info Sidebar -->
            <div class="space-y-6">
              <div class="stats-card rounded-2xl p-6 border border-primary-200">
                <h3 class="font-bold text-primary-800 text-lg mb-6 flex items-center">
                  <i class="fas fa-info-circle text-primary-500 mr-2"></i>
                  Booking Tips
                </h3>
                <div class="space-y-4">
                  <div class="flex items-start">
                    <div class="bg-primary-100 p-2 rounded-lg mr-3">
                      <i class="fas fa-clock text-primary-500"></i>
                    </div>
                    <div>
                      <h4 class="font-medium text-primary-800">Arrive Early</h4>
                      <p class="text-sm text-primary-600">Please arrive 10 minutes before your appointment</p>
                    </div>
                  </div>

                  <div class="flex items-start">
                    <div class="bg-primary-100 p-2 rounded-lg mr-3">
                      <i class="fas fa-shampoo text-primary-500"></i>
                    </div>
                    <div>
                      <h4 class="font-medium text-primary-800">Clean Hair</h4>
                      <p class="text-sm text-primary-600">Please arrive with clean, dry hair</p>
                    </div>
                  </div>

                  <div class="flex items-start">
                    <div class="bg-primary-100 p-2 rounded-lg mr-3">
                      <i class="fas fa-utensils text-primary-500"></i>
                    </div>
                    <div>
                      <h4 class="font-medium text-primary-800">Bring Snacks</h4>
                      <p class="text-sm text-primary-600">Long sessions - feel free to bring snacks</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="stats-card rounded-2xl p-6 border border-primary-200">
                <h3 class="font-bold text-primary-800 text-lg mb-4">Need Help?</h3>
                <div class="space-y-3">
                  <div class="flex items-center text-primary-600">
                    <i class="fas fa-phone text-primary-500 mr-3"></i>
                    <span>(076) 873-2108</span>
                  </div>
                  <div class="flex items-center text-primary-600">
                    <i class="fab fa-whatsapp text-primary-500 mr-3"></i>
                    <span>WhatsApp Available</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Style Gallery Section -->
        <section id="style-gallery" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-2xl font-bold text-primary-800 mb-2">Style Gallery</h2>
            <p class="text-primary-600">Discover beautiful braiding styles by Zonke</p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Style cards will be loaded here -->
            <div class="stats-card rounded-2xl overflow-hidden card-hover">
              <div class="h-48 bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center">
                <i class="fas fa-images text-4xl text-primary-300"></i>
              </div>
              <div class="p-6">
                <h3 class="font-bold text-primary-800 text-lg mb-2">Box Braids</h3>
                <p class="text-primary-600 text-sm mb-4">Classic protective style that lasts 4-6 weeks</p>
                <div class="flex items-center justify-between">
                  <span class="font-bold text-primary-600">R500</span>
                  <span class="text-sm text-primary-500">
                    <i class="fas fa-clock mr-1"></i>3-4 hours
                  </span>
                </div>
                <button class="w-full mt-4 btn-gradient-primary text-white py-2 rounded-lg transition">
                  <i class="fas fa-heart mr-2"></i>Save Style
                </button>
              </div>
            </div>

            <div class="stats-card rounded-2xl overflow-hidden card-hover">
              <div class="h-48 bg-gradient-to-br from-blue-100 to-cyan-100 flex items-center justify-center">
                <i class="fas fa-images text-4xl text-blue-300"></i>
              </div>
              <div class="p-6">
                <h3 class="font-bold text-primary-800 text-lg mb-2">Knotless Braids</h3>
                <p class="text-primary-600 text-sm mb-4">Seamless, natural look with less tension</p>
                <div class="flex items-center justify-between">
                  <span class="font-bold text-primary-600">R600</span>
                  <span class="text-sm text-primary-500">
                    <i class="fas fa-clock mr-1"></i>4-5 hours
                  </span>
                </div>
                <button class="w-full mt-4 btn-gradient-primary text-white py-2 rounded-lg transition">
                  <i class="fas fa-heart mr-2"></i>Save Style
                </button>
              </div>
            </div>

            <div class="stats-card rounded-2xl overflow-hidden card-hover">
              <div class="h-48 bg-gradient-to-br from-green-100 to-emerald-100 flex items-center justify-center">
                <i class="fas fa-images text-4xl text-green-300"></i>
              </div>
              <div class="p-6">
                <h3 class="font-bold text-primary-800 text-lg mb-2">Cornrows</h3>
                <p class="text-primary-600 text-sm mb-4">Traditional style perfect for all hair types</p>
                <div class="flex items-center justify-between">
                  <span class="font-bold text-primary-600">R350</span>
                  <span class="text-sm text-primary-500">
                    <i class="fas fa-clock mr-1"></i>2-3 hours
                  </span>
                </div>
                <button class="w-full mt-4 btn-gradient-primary text-white py-2 rounded-lg transition">
                  <i class="fas fa-heart mr-2"></i>Save Style
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- My Profile Section -->
        <section id="my-profile" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-2xl font-bold text-primary-800 mb-2">My Profile</h2>
            <p class="text-primary-600">Manage your hair profile and preferences</p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
              <div class="stats-card rounded-2xl p-6 md:p-8 border border-primary-200">
                <h3 class="font-bold text-primary-800 text-lg mb-6">Hair Profile</h3>
                
                <div class="space-y-6">
                  <div>
                    <label class="block text-sm font-semibold text-primary-600 mb-3">
                      <i class="fas fa-hair text-primary-500 mr-2"></i>
                      Hair Type
                    </label>
                    <select id="hair-type" class="input-modern w-full rounded-xl p-4">
                      <option value="">Select hair type</option>
                      <option value="straight">Straight</option>
                      <option value="wavy">Wavy</option>
                      <option value="curly">Curly</option>
                      <option value="coily">Coily/Kinky</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-primary-600 mb-3">
                      <i class="fas fa-ruler text-primary-500 mr-2"></i>
                      Hair Length
                    </label>
                    <select id="hair-length" class="input-modern w-full rounded-xl p-4">
                      <option value="">Select length</option>
                      <option value="short">Short (Ear length)</option>
                      <option value="medium">Medium (Shoulder length)</option>
                      <option value="long">Long (Below shoulders)</option>
                      <option value="very-long">Very Long (Mid back+)</option>
                    </select>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-primary-600 mb-3">
                      <i class="fas fa-allergies text-primary-500 mr-2"></i>
                      Allergies/Sensitivities
                    </label>
                    <textarea id="allergies" class="input-modern w-full rounded-xl p-4" rows="3" placeholder="List any product allergies or sensitivities..."></textarea>
                  </div>

                  <div>
                    <label class="block text-sm font-semibold text-primary-600 mb-3">
                      <i class="fas fa-sticky-note text-primary-500 mr-2"></i>
                      Notes for Zonke
                    </label>
                    <textarea id="stylist-notes" class="input-modern w-full rounded-xl p-4" rows="4" placeholder="Any special notes or preferences for your stylist..."></textarea>
                  </div>

                  <button id="save-profile" class="btn-gradient-primary text-white px-6 py-3 rounded-xl font-semibold">
                    <i class="fas fa-save mr-2"></i>Save Profile
                  </button>
                </div>
              </div>
            </div>

            <div class="space-y-6">
              <div class="stats-card rounded-2xl p-6 border border-primary-200">
                <h3 class="font-bold text-primary-800 text-lg mb-4">Style History</h3>
                <div id="style-history" class="space-y-3">
                  <div class="p-3 bg-primary-50 rounded-lg">
                    <div class="flex justify-between items-center mb-1">
                      <span class="font-medium">Box Braids</span>
                      <span class="text-sm text-primary-500">Feb 15, 2024</span>
                    </div>
                    <p class="text-sm text-primary-600">Maintenance appointment</p>
                  </div>
                  <!-- More history will load here -->
                </div>
              </div>

              <div class="stats-card rounded-2xl p-6 border border-primary-200">
                <h3 class="font-bold text-primary-800 text-lg mb-4">Your Preferences</h3>
                <div class="space-y-3">
                  <div class="flex items-center">
                    <i class="fas fa-music text-primary-500 mr-3"></i>
                    <span class="text-primary-700">Music preference:</span>
                    <span class="ml-2 text-primary-600" id="music-pref">Not set</span>
                  </div>
                  <div class="flex items-center">
                    <i class="fas fa-coffee text-primary-500 mr-3"></i>
                    <span class="text-primary-700">Drink preference:</span>
                    <span class="ml-2 text-primary-600" id="drink-pref">Not set</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Messages Section -->
        <section id="messages" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-2xl font-bold text-primary-800 mb-2">Messages</h2>
            <p class="text-primary-600">Chat directly with Zonke</p>
          </div>

          <div class="stats-card rounded-2xl p-6 border border-primary-200">
            <div class="h-96 overflow-y-auto mb-4 p-4 bg-primary-50 rounded-xl" id="chat-messages">
              <div class="text-center text-primary-500">
                <i class="fas fa-comments text-3xl mb-3"></i>
                <p>Start a conversation with Zonke</p>
                <p class="text-sm mt-2">Ask questions about styles, pricing, or availability</p>
              </div>
            </div>

            <div class="flex space-x-3">
              <input type="text" id="message-input" placeholder="Type your message..." class="input-modern flex-1 rounded-xl p-4">
              <button id="send-message" class="btn-gradient-primary text-white px-6 py-4 rounded-xl font-semibold">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4" style="background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px);">
      <div class="bg-white rounded-2xl max-w-md w-full mx-auto transform transition-all p-8 text-center slide-up">
        <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
          <i class="fas fa-check text-white text-2xl"></i>
        </div>
        <h3 class="text-2xl font-bold text-primary-800 mb-2">Booking Confirmed!</h3>
        <p class="text-primary-600 mb-6">Your appointment has been successfully scheduled.</p>
        <button id="close-success-modal" class="w-full btn-gradient-primary text-white px-6 py-3 rounded-xl font-semibold shadow hover:shadow-lg transition-all">
          Continue
        </button>
      </div>
    </div>

    <script type="module">
      // Import Firebase
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
      import {
        getFirestore,
        collection,
        addDoc,
        query,
        where,
        getDocs,
        Timestamp,
        deleteDoc,
        doc,
        setDoc,
        getDoc,
        onSnapshot,
        orderBy,
        updateDoc,
        limit,
        serverTimestamp
      } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyCkgSvUKoR0FCXARDmgOqoXySMbCh5EMY8",
        authDomain: "braids-by-zonke.firebaseapp.com",
        projectId: "braids-by-zonke",
        storageBucket: "braids-by-zonke.firebasestorage.app",
        messagingSenderId: "537270598591",
        appId: "1:537270598591:web:324dd06538c213627abf0a",
        measurementId: "G-NR21BKSR8N",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      let currentUser = null;

      // Utility functions for SweetAlert2
      function showSuccess(message, title = "Success") {
        Swal.fire({
          title: title,
          text: message,
          icon: 'success',
          confirmButtonColor: '#ea7c2a',
          timer: 3000
        });
      }

      function showError(message, title = "Error") {
        Swal.fire({
          title: title,
          text: message,
          icon: 'error',
          confirmButtonColor: '#ea7c2a'
        });
      }

      function showConfirm(message, callback, title = "Are you sure?") {
        Swal.fire({
          title: title,
          text: message,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ea7c2a',
          cancelButtonColor: '#6b7280',
          confirmButtonText: 'Yes, proceed',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            callback();
          }
        });
      }

      // DOM Elements
      const mobileMenuButton = document.getElementById("menuBtn");
      const closeSidebar = document.getElementById("close-sidebar");
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("overlay");
      const logoutBtn = document.getElementById("logout-btn");
      const newAppointmentBtn = document.getElementById("new-appointment-btn");

      // Mobile Sidebar
      function openMobileSidebar() {
        sidebar.classList.add("open");
        overlay.classList.add("open");
        document.body.style.overflow = "hidden";
      }

      function closeMobileSidebar() {
        sidebar.classList.remove("open");
        overlay.classList.remove("open");
        document.body.style.overflow = "auto";
      }

      mobileMenuButton.addEventListener("click", openMobileSidebar);
      closeSidebar.addEventListener("click", closeMobileSidebar);
      overlay.addEventListener("click", closeMobileSidebar);

      // Navigation
      function navigateToSection(targetId) {
        document.querySelectorAll(".sidebar-item").forEach((i) => i.classList.remove("active"));
        
        const clickedItem = document.querySelector(`a[href="#${targetId}"]`);
        if (clickedItem) clickedItem.classList.add("active");

        document.querySelectorAll("section").forEach((section) => {
          section.classList.add("hidden");
        });
        
        const targetSection = document.getElementById(targetId);
        if (targetSection) {
          targetSection.classList.remove("hidden");
          targetSection.classList.add("fade-in");
        }

        updatePageTitle(targetId);

        if (targetId === "bookings") {
          loadBookings();
        } else if (targetId === "my-profile") {
          loadProfile();
        } else if (targetId === "messages") {
          loadMessages();
        }

        if (window.innerWidth < 768) {
          closeMobileSidebar();
        }
      }

      document.querySelectorAll(".sidebar-item").forEach((item) => {
        item.addEventListener("click", function (e) {
          e.preventDefault();
          const target = this.getAttribute("href").substring(1);
          navigateToSection(target);
        });
      });

      document.querySelectorAll(".quick-link").forEach((btn) => {
        btn.addEventListener("click", function(e) {
          e.preventDefault();
          const target = this.getAttribute("href").substring(1);
          navigateToSection(target);
        });
      });

      newAppointmentBtn.addEventListener("click", function() {
        navigateToSection("new-booking");
      });

      function updatePageTitle(section) {
        const titles = {
          dashboard: { title: "Dashboard", subtitle: "Welcome to your client portal" },
          bookings: { title: "My Bookings", subtitle: "Manage your appointments" },
          "new-booking": { title: "New Booking", subtitle: "Schedule your next appointment" },
          "style-gallery": { title: "Style Gallery", subtitle: "Discover beautiful braiding styles" },
          "my-profile": { title: "My Profile", subtitle: "Manage your hair profile" },
          "messages": { title: "Messages", subtitle: "Chat with Zonke" },
        };

        const titleData = titles[section];
        if (titleData) {
          document.getElementById("page-title").textContent = titleData.title;
          document.getElementById("page-subtitle").textContent = titleData.subtitle;
        }
      }

      // Booking Form
      document.querySelectorAll('input[name="style"]').forEach((radio) => {
        radio.addEventListener('change', updateBookingSummary);
      });

      function updateBookingSummary() {
        const selectedStyle = document.querySelector('input[name="style"]:checked');
        if (selectedStyle) {
          const price = parseInt(selectedStyle.dataset.price);
          document.getElementById('total-amount').textContent = 'R' + price;
        }
      }
      updateBookingSummary();

      // Set minimum date to tomorrow
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.getElementById("date").min = tomorrow.toISOString().split("T")[0];
      document.getElementById("date").value = tomorrow.toISOString().split("T")[0];
      document.getElementById("time").value = "09:00";

      // Tab functionality
      document.querySelectorAll(".tab-button").forEach((button) => {
        button.addEventListener("click", function () {
          const tab = this.getAttribute("data-tab");

          document.querySelectorAll(".tab-button").forEach((b) => {
            b.classList.remove("border-b-2", "border-primary-500", "text-primary-600");
            b.classList.add("text-primary-500");
          });
          this.classList.add("border-b-2", "border-primary-500", "text-primary-600");

          document.getElementById("upcoming-bookings").classList.add("hidden");
          document.getElementById("past-bookings").classList.add("hidden");
          document.getElementById(`${tab}-bookings`).classList.remove("hidden");
        });
      });

      // Authentication
      onAuthStateChanged(auth, (user) => {
        if (user) {
          currentUser = user;
          document.getElementById("userEmail").textContent = user.email;
          document.getElementById("user-name").textContent = user.email.split('@')[0];
          document.getElementById("user-initial").textContent = user.email.charAt(0).toUpperCase();
          
          if (document.getElementById('welcome-message')) {
            document.getElementById('welcome-message').textContent = 
              `Welcome back, ${user.email.split('@')[0]}!`;
          }
          
          loadDashboardData();
          loadBookings();
          loadProfile();
          loadMessages();
          updatePageTitle('dashboard');
        } else {
          window.location.href = "index.html";
        }
      });

      async function logout() {
        showConfirm("Are you sure you want to logout?", async () => {
          try {
            await signOut(auth);
          } catch (error) {
            console.error("Logout error:", error);
            showError("Error logging out. Please try again.");
          }
        });
      }
      logoutBtn.addEventListener("click", logout);

      // Save Booking
      document.getElementById("bookingForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById("submit-booking");
        const submitText = document.getElementById("submit-text");
        const submitLoading = document.getElementById("submit-loading");

        submitBtn.disabled = true;
        submitText.textContent = "Processing...";
        submitLoading.classList.remove("hidden");

        try {
          const selectedStyle = document.querySelector('input[name="style"]:checked');
          const style = selectedStyle.value;
          const price = parseInt(selectedStyle.dataset.price);
          const date = document.getElementById("date").value;
          const time = document.getElementById("time").value;
          const specialRequests = document.getElementById("specialRequests").value;

          await addDoc(collection(db, "bookings"), {
            userId: currentUser.uid,
            userEmail: currentUser.email,
            userName: currentUser.email.split('@')[0],
            style,
            price,
            date,
            time,
            specialRequests,
            status: "upcoming",
            createdAt: Timestamp.now(),
          });

          document.getElementById("bookingForm").reset();
          document.getElementById("date").value = tomorrow.toISOString().split("T")[0];
          document.getElementById("time").value = "09:00";
          updateBookingSummary();

          document.getElementById("success-modal").classList.remove("hidden");
          showSuccess("Appointment booked successfully!");
          
        } catch (error) {
          console.error("Error creating booking:", error);
          showError("There was an error creating your booking. Please try again.");
        } finally {
          submitBtn.disabled = false;
          submitText.textContent = "Book Appointment";
          submitLoading.classList.add("hidden");
        }
      });

      // Close success modal
      document.getElementById("close-success-modal").addEventListener("click", () => {
        document.getElementById("success-modal").classList.add("hidden");
        loadDashboardData();
        loadBookings();
        navigateToSection("bookings");
      });

      // Load Dashboard Data
      async function loadDashboardData() {
        if (!currentUser) return;

        try {
          const q = query(collection(db, "bookings"), where("userId", "==", currentUser.uid));
          const snapshot = await getDocs(q);

          let upcoming = 0;
          let completed = 0;
          let totalStyles = 0;
          let nextAppointment = null;
          let activities = [];

          snapshot.forEach((doc) => {
            const b = doc.data();
            activities.push({ ...b, id: doc.id });
            
            if (b.status === "upcoming") {
              upcoming++;
              if (!nextAppointment || new Date(b.date) < new Date(nextAppointment.date)) {
                nextAppointment = b;
              }
            }
            if (b.status === "completed") {
              completed++;
              totalStyles++;
            }
          });

          document.getElementById("booking-count").textContent = upcoming + completed;
          document.getElementById("total-styles").textContent = totalStyles;
          document.getElementById("loyalty-points").textContent = totalStyles * 10;
          
          if (nextAppointment) {
            const date = new Date(nextAppointment.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
              weekday: 'short', 
              month: 'short', 
              day: 'numeric' 
            });
            document.getElementById("next-appointment").textContent = `${formattedDate} at ${nextAppointment.time}`;
          }

          // Update activity feed
          const activityDiv = document.getElementById("recent-activity");
          activityDiv.innerHTML = "";

          if (activities.length === 0) {
            activityDiv.innerHTML = `
              <div class="p-8 text-center">
                <div class="inline-block p-4 rounded-full bg-primary-100 mb-4">
                  <i class="fas fa-calendar-plus text-2xl text-primary-400"></i>
                </div>
                <h3 class="font-bold text-primary-700 mb-2">No Activity Yet</h3>
                <p class="text-primary-500">Book your first appointment to get started!</p>
              </div>`;
            return;
          }

          activities.sort((a, b) => new Date(b.date) - new Date(a.date));
          
          activities.slice(0, 3).forEach((act) => {
            const isUpcoming = act.status === "upcoming";
            const date = new Date(act.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
              month: 'short', 
              day: 'numeric' 
            });
            
            activityDiv.innerHTML += `
              <div class="p-5 flex items-center hover:bg-primary-50 transition">
                <div class="${isUpcoming ? 'bg-blue-100' : 'bg-green-100'} p-3 rounded-xl mr-4">
                  <i class="fas ${isUpcoming ? 'fa-clock text-blue-600' : 'fa-check text-green-600'}"></i>
                </div>
                <div class="flex-1">
                  <p class="font-semibold text-primary-800">${act.style}</p>
                  <p class="text-sm text-primary-600">
                    <i class="fas fa-calendar-alt mr-1"></i>${formattedDate} 
                    <i class="fas fa-clock ml-3 mr-1"></i>${act.time}
                  </p>
                </div>
                <span class="px-3 py-1 text-xs rounded-full ${isUpcoming ? 'badge-upcoming' : 'badge-completed'}">
                  ${act.status}
                </span>
              </div>`;
          });

        } catch (error) {
          console.error("Error loading dashboard data:", error);
          showError("Failed to load dashboard data");
        }
      }

      // Load Bookings
      async function loadBookings() {
        if (!currentUser) return;

        try {
          const q = query(collection(db, "bookings"), where("userId", "==", currentUser.uid));
          const snapshot = await getDocs(q);

          const upcomingDiv = document.getElementById("upcoming-bookings");
          const pastDiv = document.getElementById("past-bookings");
          upcomingDiv.innerHTML = "";
          pastDiv.innerHTML = "";

          let upcomingCount = 0;
          let pastCount = 0;

          if (snapshot.empty) {
            upcomingDiv.innerHTML = `
              <div class="p-8 text-center">
                <div class="inline-block p-4 rounded-full bg-primary-100 mb-4">
                  <i class="fas fa-calendar-plus text-2xl text-primary-400"></i>
                </div>
                <h3 class="font-bold text-primary-700 mb-2">No Bookings Yet</h3>
                <p class="text-primary-500 mb-4">You haven't booked any appointments yet.</p>
                <button onclick="navigateToSection('new-booking')" class="btn-gradient-primary text-white px-4 py-2 rounded-lg font-medium inline-flex items-center">
                  <i class="fas fa-plus-circle mr-2"></i>Book Your First Appointment
                </button>
              </div>`;
            pastDiv.innerHTML = `
              <div class="p-8 text-center">
                <p class="text-primary-500">No past appointments found.</p>
              </div>`;
            
            document.getElementById("upcoming-tab-count").textContent = "0";
            document.getElementById("past-tab-count").textContent = "0";
            return;
          }

          snapshot.forEach((doc) => {
            const b = doc.data();
            const isUpcoming = b.status === "upcoming";
            const date = new Date(b.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
              weekday: 'short', 
              year: 'numeric', 
              month: 'short', 
              day: 'numeric' 
            });
            
            const html = `
              <div class="p-6 hover:bg-primary-50 transition">
                <div class="flex flex-col md:flex-row md:items-center justify-between">
                  <div class="mb-4 md:mb-0">
                    <div class="flex items-center mb-3">
                      <h3 class="font-bold text-primary-800 text-lg">${b.style}</h3>
                      <span class="px-3 py-1 text-xs rounded-full ${isUpcoming ? 'badge-upcoming' : 'badge-completed'} ml-3">
                        ${b.status}
                      </span>
                    </div>
                    <div class="flex flex-wrap gap-4 text-sm text-primary-600">
                      <div class="flex items-center">
                        <i class="fas fa-calendar-alt mr-2 text-primary-400"></i>
                        ${formattedDate}
                      </div>
                      <div class="flex items-center">
                        <i class="fas fa-clock mr-2 text-primary-400"></i>
                        ${b.time}
                      </div>
                      <div class="flex items-center">
                        <i class="fas fa-tag mr-2 text-primary-400"></i>
                        R${b.price}
                      </div>
                    </div>
                    ${b.specialRequests ? `
                      <div class="mt-3 p-3 bg-primary-50 rounded-lg">
                        <p class="text-sm text-primary-700">
                          <i class="fas fa-sticky-note mr-2 text-primary-400"></i>
                          ${b.specialRequests}
                        </p>
                      </div>
                    ` : ''}
                  </div>
                  <div class="flex space-x-2">
                    ${isUpcoming ? `
                      <button onclick="cancelBooking('${doc.id}')" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition font-medium flex items-center">
                        <i class="fas fa-times mr-2"></i>Cancel
                      </button>
                    ` : `
                      <button onclick="bookAgain('${b.style}')" class="px-4 py-2 btn-gradient-primary text-white rounded-lg hover:opacity-90 transition font-medium flex items-center">
                        <i class="fas fa-redo mr-2"></i>Book Again
                      </button>
                    `}
                  </div>
                </div>
              </div>`;
            
            if (isUpcoming) {
              upcomingDiv.innerHTML += html;
              upcomingCount++;
            } else {
              pastDiv.innerHTML += html;
              pastCount++;
            }
          });

          document.getElementById("upcoming-tab-count").textContent = upcomingCount;
          document.getElementById("past-tab-count").textContent = pastCount;

          if (!upcomingCount) {
            upcomingDiv.innerHTML = `
              <div class="p-8 text-center">
                <div class="inline-block p-4 rounded-full bg-primary-100 mb-4">
                  <i class="fas fa-calendar-check text-2xl text-primary-400"></i>
                </div>
                <h3 class="font-bold text-primary-700 mb-2">No Upcoming Bookings</h3>
                <p class="text-primary-500">You don't have any upcoming appointments.</p>
              </div>`;
          }

          if (!pastCount) {
            pastDiv.innerHTML = `
              <div class="p-8 text-center">
                <p class="text-primary-500">No past appointments found.</p>
              </div>`;
          }

        } catch (error) {
          console.error("Error loading bookings:", error);
          showError("Failed to load bookings");
        }
      }

      // Cancel Booking
      window.cancelBooking = async (id) => {
        showConfirm("Are you sure you want to cancel this booking? This action cannot be undone.", async () => {
          try {
            await deleteDoc(doc(db, "bookings", id));
            showSuccess("Booking cancelled successfully!");
            loadDashboardData();
            loadBookings();
          } catch (error) {
            console.error("Error canceling booking:", error);
            showError("Failed to cancel booking");
          }
        });
      };

      // Book Again
      window.bookAgain = (style) => {
        navigateToSection("new-booking");
        setTimeout(() => {
          const styleRadio = document.querySelector(`input[value="${style}"]`);
          if (styleRadio) {
            styleRadio.checked = true;
            updateBookingSummary();
          }
        }, 300);
      };

      // Load Profile
      async function loadProfile() {
        if (!currentUser) return;

        try {
          const userDoc = await getDoc(doc(db, "users", currentUser.uid));
          
          if (userDoc.exists()) {
            const userData = userDoc.data();
            document.getElementById("hair-type").value = userData.hairType || "";
            document.getElementById("hair-length").value = userData.hairLength || "";
            document.getElementById("allergies").value = userData.allergies || "";
            document.getElementById("stylist-notes").value = userData.stylistNotes || "";
            document.getElementById("music-pref").textContent = userData.musicPref || "Not set";
            document.getElementById("drink-pref").textContent = userData.drinkPref || "Not set";
          }

          const bookingsQuery = query(
            collection(db, "bookings"), 
            where("userId", "==", currentUser.uid),
            where("status", "==", "completed")
          );
          const snapshot = await getDocs(bookingsQuery);
          
          const historyDiv = document.getElementById("style-history");
          historyDiv.innerHTML = "";
          
          snapshot.forEach((doc) => {
            const b = doc.data();
            const date = new Date(b.date);
            const formattedDate = date.toLocaleDateString('en-US', { 
              month: 'short', 
              day: 'numeric',
              year: 'numeric'
            });
            
            historyDiv.innerHTML += `
              <div class="p-3 bg-primary-50 rounded-lg">
                <div class="flex justify-between items-center mb-1">
                  <span class="font-medium">${b.style}</span>
                  <span class="text-sm text-primary-500">${formattedDate}</span>
                </div>
                ${b.specialRequests ? `<p class="text-sm text-primary-600">${b.specialRequests.substring(0, 50)}...</p>` : ''}
              </div>`;
          });

          if (snapshot.empty) {
            historyDiv.innerHTML = `
              <div class="text-center text-primary-500 py-4">
                <i class="fas fa-history text-2xl mb-2"></i>
                <p>No style history yet</p>
              </div>`;
          }

        } catch (error) {
          console.error("Error loading profile:", error);
          showError("Failed to load profile");
        }
      }

      // Save Profile
      document.getElementById("save-profile").addEventListener("click", async () => {
        try {
          await setDoc(doc(db, "users", currentUser.uid), {
            email: currentUser.email,
            hairType: document.getElementById("hair-type").value,
            hairLength: document.getElementById("hair-length").value,
            allergies: document.getElementById("allergies").value,
            stylistNotes: document.getElementById("stylist-notes").value,
            updatedAt: Timestamp.now()
          }, { merge: true });

          showSuccess("Profile saved successfully!");
          loadProfile();
        } catch (error) {
          console.error("Error saving profile:", error);
          showError("Error saving profile. Please try again.");
        }
      });

      // Load Messages
      async function loadMessages() {
        if (!currentUser) return;

        try {
          const messagesQuery = query(
            collection(db, "messages"),
            where("userId", "==", currentUser.uid),
            orderBy("createdAt", "desc")
          );
          
          const snapshot = await getDocs(q);
          const messagesDiv = document.getElementById("chat-messages");
          messagesDiv.innerHTML = "";

          if (snapshot.empty) {
            messagesDiv.innerHTML = `
              <div class="text-center text-primary-500 py-8">
                <i class="fas fa-comments text-3xl mb-3"></i>
                <p>Start a conversation with Zonke</p>
                <p class="text-sm mt-2">Ask questions about styles, pricing, or availability</p>
              </div>`;
            return;
          }

          snapshot.forEach((doc) => {
            const msg = doc.data();
            const time = msg.createdAt?.toDate().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) || '';
            
            messagesDiv.innerHTML += `
              <div class="mb-4">
                <div class="${msg.sender === 'client' ? 'text-right' : 'text-left'}">
                  <div class="inline-block max-w-[70%] rounded-2xl px-4 py-2 ${
                    msg.sender === 'client' 
                      ? 'bg-gradient-to-r from-primary-500 to-primary-600 text-white' 
                      : 'bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800'
                  }">
                    <p>${msg.text}</p>
                    <p class="text-xs opacity-75 mt-1">${time}</p>
                  </div>
                </div>
              </div>`;
          });

          messagesDiv.scrollTop = messagesDiv.scrollHeight;

        } catch (error) {
          console.error("Error loading messages:", error);
          showError("Failed to load messages");
        }
      }

      // Send Message
      document.getElementById("send-message").addEventListener("click", async () => {
        const input = document.getElementById("message-input");
        const message = input.value.trim();
        
        if (!message) return;

        try {
          await addDoc(collection(db, "messages"), {
            userId: currentUser.uid,
            userEmail: currentUser.email,
            userName: currentUser.email.split('@')[0],
            text: message,
            sender: "client",
            createdAt: Timestamp.now()
          });

          input.value = "";
          loadMessages();
          showSuccess("Message sent!");

        } catch (error) {
          console.error("Error sending message:", error);
          showError("Error sending message. Please try again.");
        }
      });

      // Send message on Enter key
      document.getElementById("message-input").addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          document.getElementById("send-message").click();
        }
      });

      // Global navigate function
      window.navigateToSection = navigateToSection;

      // Initialize
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelector('a[href="#dashboard"]').classList.add('active');
      });

    </script>
     <script src="/public/js/booking.js"></script>
    <script src="/public/js/booking.js"></script>
    <script src="/public/js/main.js"></script>
    <script src="/public/js/booking-auth.js"></script>
  </body>
</html>